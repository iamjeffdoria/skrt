{% extends 'webapp/base.html' %}
{% load static %}

{% block content %}
<!-- Header for printing (Hidden by default) -->
<div class="print-header d-print-block d-none">
    <p>Republic of the Philippines</p>
    <p>PALOMPON INSTITUTE OF TECHNOLOGY</p>
    <p>Palompon, Leyte</p>
    <p>COLLEGE OF TECHNOLOGY AND ENGINEERING</p>
    <p>Information Technology Department</p>
</div>

<!-- Logo container for printing (Hidden by default) -->
<div class="logo-container d-print-block d-none">
    <div class="logo-left">
        <img src="{% static 'img/pitLOGO.png' %}" alt="PIT Logo" class="logo-img">
    </div>
    <div class="logo-right">
        <img src="{% static 'img/cote.png' %}" alt="COTE Logo" class="logo-img">
    </div>
</div>

<!-- Student Information Section -->
<div class="student-info d-flex justify-content-between align-items-center mb-3 ">
    <div class="info-text ">
        <p><strong><ion-icon name="id-card-outline"></ion-icon>&nbsp;Student ID:</strong> {{ student.student_id }}</p> 
        <p><strong><ion-icon name="person-circle-outline"></ion-icon>&nbsp;Student Name:</strong> {{ student.first_name }} {{ student.last_name }}</p>
        <p><strong><ion-icon name="bookmarks-outline"></ion-icon>&nbsp;Course:</strong> {{ student.course }}</p>
    </div>
    <!-- Print Report Button -->
    <button class="btn btn-outline-dark btn-futuristic" onclick="window.print()">
        <i class="fa fa-print" aria-hidden="true"></i> Print Report
    </button>
</div>

<!-- Filter form -->
<div class="text-center mb-3">
    <form id="filter-form" method="get" class="d-inline-flex align-items-center">
        <div class="form-group mr-3">
            <label for="start_date" class="mr-2 mb-0">Start Date:</label>
            <input type="date" id="start_date" name="start_date" class="form-control d-inline-block border-dark" value="{{ request.GET.start_date }}">
        </div>
        <div class="form-group mr-3">
            <label for="end_date" class="mr-2 mb-0">End Date:</label>
            <input type="date" id="end_date" name="end_date" class="form-control d-inline-block border-dark" value="{{ request.GET.end_date }}">
        </div>
        <input type="hidden" name="entries" value="{{ request.GET.entries }}">
    </form>
</div>

<!-- Entries dropdown form -->
<form id="entries-form" method="get" class="d-inline-block">
    <div class="form-group d-flex align-items-center">
        <label for="entries" class="mr-2 mb-0">Show</label>
        <select id="entries" name="entries" class="form-control border-dark mx-2" onchange="document.getElementById('entries-form').submit();">
            <option value="">------</option>  <!-- Default option to show paginated records -->
            <option value="5" {% if request.GET.entries == "5" %}selected{% endif %}>5</option>
            <option value="10" {% if request.GET.entries == "10" %}selected{% endif %}>10</option>
            <option value="25" {% if request.GET.entries == "25" %}selected{% endif %}>25</option>
            <option value="50" {% if request.GET.entries == "50" %}selected{% endif %}>50</option>
            <option value="all" {% if request.GET.entries == "all" %}selected{% endif %}>All</option>  <!-- Show all records -->
        </select>
        <span class="ml-2">entries</span>
        <!-- Preserving the hidden inputs -->
        <input type="hidden" name="start_date" value="{{ request.GET.start_date }}">
        <input type="hidden" name="end_date" value="{{ request.GET.end_date }}">
    </div>
</form>


<!-- Display the logs in a table -->
<div class="table-container">
    <div class="table-scroll">
        <table class="table table-hover table-border table-striped table-futuristic">
            <thead >
                <tr>
                    <th><ion-icon name="log-in-outline"></ion-icon>&nbsp;Log Type</th>  <!-- Login or Logout -->
                    <th><ion-icon name="calendar-outline"></ion-icon>&nbsp;Date</th>  <!-- Date of the log -->
                    <th><ion-icon name="time-outline"></ion-icon>&nbsp;Time</th>  <!-- Exact time of the log -->
                </tr>
            </thead>
            <tbody>
                {% for log in logs %}
                <tr>
                    <td>
                        {% if log.type == 'login' %}
                            <span class="badge bg-success px-3 py-2">Login</span>
                        {% else %}
                            <span class="badge bg-danger px-3 py-2">Logout</span>
                        {% endif %}
                    </td>
                    <td>{{ log.time|date:"F d Y" }}</td>  <!-- Display date with month as word -->
                    <td>{{ log.time|date:"h:i A" }}</td>  <!-- Display time in 12-hour format -->
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3">No logs available.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Pagination controls -->
<div class="pagination">
    <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="?{% if request.GET.start_date %}start_date={{ request.GET.start_date }}&{% endif %}{% if request.GET.end_date %}end_date={{ request.GET.end_date }}&{% endif %}entries={{ request.GET.entries }}&page=1" class="btn btn-outline-dark">« First</a>
            <a href="?{% if request.GET.start_date %}start_date={{ request.GET.start_date }}&{% endif %}{% if request.GET.end_date %}end_date={{ request.GET.end_date }}&{% endif %}entries={{ request.GET.entries }}&page={{ page_obj.previous_page_number }}" class="btn btn-outline-dark">‹ Previous</a>
        {% endif %}
    </span>
    
    <span class="page-numbers">
        {% if page_obj.paginator.num_pages > 7 %}
            {% if page_obj.number > 4 %}
                <a href="?{% if request.GET.start_date %}start_date={{ request.GET.start_date }}&{% endif %}{% if request.GET.end_date %}end_date={{ request.GET.end_date }}&{% endif %}entries={{ request.GET.entries }}&page=1" class="btn btn-outline-dark">1</a>
                <span class="btn btn-outline-dark disabled">...</span>
            {% endif %}
            
            {% for num in page_obj.paginator.page_range %}
                {% if num >= page_obj.number|add:"-2" and num <= page_obj.number|add:"2" %}
                    {% if page_obj.number == num %}
                        <span class="current btn btn-primary">{{ num }}</span>
                    {% else %}
                        <a href="?{% if request.GET.start_date %}start_date={{ request.GET.start_date }}&{% endif %}{% if request.GET.end_date %}end_date={{ request.GET.end_date }}&{% endif %}entries={{ request.GET.entries }}&page={{ num }}" class="btn btn-outline-dark">{{ num }}</a>
                    {% endif %}
                {% endif %}
            {% endfor %}
            
            {% if page_obj.number < page_obj.paginator.num_pages|add:"-3" %}
                <span class="btn btn-outline-dark disabled">...</span>
                <a href="?{% if request.GET.start_date %}start_date={{ request.GET.start_date }}&{% endif %}{% if request.GET.end_date %}end_date={{ request.GET.end_date }}&{% endif %}entries={{ request.GET.entries }}&page={{ page_obj.paginator.num_pages }}" class="btn btn-outline-dark">{{ page_obj.paginator.num_pages }}</a>
            {% endif %}
        {% else %}
            {% for num in page_obj.paginator.page_range %}
                {% if page_obj.number == num %}
                    <span class="current btn btn-primary">{{ num }}</span>
                {% else %}
                    <a href="?{% if request.GET.start_date %}start_date={{ request.GET.start_date }}&{% endif %}{% if request.GET.end_date %}end_date={{ request.GET.end_date }}&{% endif %}entries={{ request.GET.entries }}&page={{ num }}" class="btn btn-outline-dark">{{ num }}</a>
                {% endif %}
            {% endfor %}
        {% endif %}
    </span>
    
    <span class="step-links">
        {% if page_obj.has_next %}
            <a href="?{% if request.GET.start_date %}start_date={{ request.GET.start_date }}&{% endif %}{% if request.GET.end_date %}end_date={{ request.GET.end_date }}&{% endif %}entries={{ request.GET.entries }}&page={{ page_obj.next_page_number }}" class="btn btn-outline-dark">Next ›</a>
            <a href="?{% if request.GET.start_date %}start_date={{ request.GET.start_date }}&{% endif %}{% if request.GET.end_date %}end_date={{ request.GET.end_date }}&{% endif %}entries={{ request.GET.entries }}&page={{ page_obj.paginator.num_pages }}" class="btn btn-outline-dark">Last »</a>
        {% endif %}
    </span>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('filter-form');
        const startDateInput = document.getElementById('start_date');
        const endDateInput = document.getElementById('end_date');

        function updateFilter() {
            form.submit();
        }

        startDateInput.addEventListener('change', updateFilter);
        endDateInput.addEventListener('change', updateFilter);
    });

    function fetchFilteredLogsAndPrint() {
        // Ensure the filter form is submitted with the correct dates before printing
        const form = document.getElementById('filter-form');
        form.submit();  // Submits the form to ensure filtered logs are shown

        // Print after form submission (you may need a slight delay to ensure the content loads)
        setTimeout(function() {
            window.print();
        }, 500);  // Adjust delay as needed based on load time
    }

    function changeTitleBeforePrint() {
        document.title = ' '; // Empty title
    }

    function restoreTitleAfterPrint() {
        document.title = 'Palompon Institute of Technology'; // Original title
    }

    window.onbeforeprint = changeTitleBeforePrint;
    window.onafterprint = restoreTitleAfterPrint;
</script>

<style>
   @media print {
    /* Position header and logos */
    .log-login, .log-logout {
    background-color: transparent !important; /* Remove background color for print */
    color: #000 !important; /* Ensure text is black for readability */
    border: none !important;  /* Remove any borders */
    padding: 0 !important;  /* Remove padding */
    font-weight: normal !important; /* Use normal text instead of bold */
    font-size: 18px !important; /* Increase font size */
}

/* Ensure badges for login/logout don't appear as buttons */
.badge {
    background-color: transparent !important;  /* Remove background color for badges */
    color: #000 !important;  /* Make sure the text is black for print */
    border: none !important;  /* Remove border */
    padding: 0 !important;  /* Remove padding for normal text appearance */
    font-weight: normal !important;  /* Ensure the text isn't bold */
    box-shadow: none !important;  /* Remove any shadows */
    font-size: 16px !important; /* Increase font size */
}

    .print-header {
        display: block;
        text-align: center;
        margin-bottom: 20px;
        font-family: 'Poppins', sans-serif;
        color: #333;
    }

    .logo-container {
        position: relative;
        width: 100%;
        margin-bottom: 20px;
    }

    .logo-left img, .logo-right img {
        position: absolute;
        top: -200px;
        width: 100px;  /* Adjust as needed */
    }

    .logo-left img {
        left: 10%;
    }

    .logo-right img {
        right: 10%;
    }

    /* Hide elements that should not be printed */
    #sidebar, 
    .topbar, 
    .btn,
    .pagination,
    #filter-form,
    #entries-form,
    .show-entries,
    .start-date,
    .end-date,
    header,
    footer,
    h5 {
        display: none !important;
    }
    ion-icon {
        display: none !important;
    }
    /* Hide icons in the student information section */
    .student-info i {
        display: none;
    }

    /* Remove border from student-info when printing */
    .student-info {
        border: none !important;
    }
    
    /* Table formatting for print */
    .table-container {
        margin: 0;
        padding: 0;
        overflow: visible !important;
    }

    .table tr {
        page-break-inside: avoid;
    }

    .table {
        width: 100%;
        border-collapse: collapse;
    }

    .table th, .table td {
        border: 1px solid #ddd;
        padding: 8px;
    }

    .table thead {
        background-color: #f2f2f2;
    }

    body {
        overflow: hidden;
    }

}


    /* Light Futuristic Styles */
    .student-info {
    background: linear-gradient(45deg, #f3f7f6, #e3e6e6);
    border-radius: 10px;
    padding: 15px;
    color: #333;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
    border: 1px solid black; /* Black border added */
}


    .btn-futuristic {
        background: #3720a0;
        border: 1px solid #ddd;
        color: #f5ebeb;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        transition: background 0.3s, box-shadow 0.3s;
    }

    .btn-futuristic:hover {
        background: linear-gradient(45deg, #f0f0f0, #ffffff);
        box-shadow: 0 6px 8px rgba(0,0,0,0.2);
        color: blue;
    }

    .table-futuristic th, .table-futuristic td {
        background-color: #ffffff;
        color: #333;
    }

    .table-futuristic thead th {
        background-color: #b1e6b1; 
        color: #1d2220;
    }

    .pagination a, .pagination .current {
        background-color: #ffffff;
        color: #333;
        border: 1px solid #ddd;
    }

    .pagination a:hover {
        background-color: #f0f0f0;
        color: #333;
    }

    .pagination .current {
        background-color: #e0e0e0;
        color: #333;
        border-color: #e0e0e0;
    }
    
</style>

{% endblock %}
